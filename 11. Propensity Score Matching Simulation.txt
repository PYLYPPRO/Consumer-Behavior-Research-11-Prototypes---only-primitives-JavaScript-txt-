<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Propensity Score Matching Simulation</title>
    <style>
        /* Styles omitted for brevity */
    </style>
</head>
<body>

<div class="container">
    <h1>19. Propensity Score Matching (PSM) Simulation</h1>
    
    <p class="explanation">
        <strong>Method Explanation:</strong> Propensity Score Matching is a statistical technique used to estimate the causal effect of a treatment (e.g., a tutoring program) when a true randomized control trial (RCT) is impossible. It matches "Treated" students with highly similar "Untreated" students (the Control group) based on a Propensity Score (the likelihood of receiving the treatment). The difference in outcomes (churn rate) is the estimated treatment effect.
    </p>

    <label for="treated_churn">1. Churn Rate in TREATED Group (Received Tutoring) (0.0 - 1.0):</label>
    <input type="number" id="treated_churn" value="0.10" min="0.0" max="1.0" step="0.01">
    
    <label for="control_churn">2. Churn Rate in MATCHED CONTROL Group (Similar Profile, No Tutoring) (0.0 - 1.0):</label>
    <input type="number" id="control_churn" value="0.15" min="0.0" max="1.0" step="0.01">

    <button onclick="calculateTreatmentEffect()">Calculate Treatment Effect</button>

    <div id="result_psm">
        Enter the churn rates for the treated and matched control groups.
    </div>
</div>

<script>
// --- Propensity Score Matching (PSM) Simulation in JavaScript ---

function calculateTreatmentEffect() {
    // 1. Collect Data
    const treatedChurn = parseFloat(document.getElementById('treated_churn').value);
    const controlChurn = parseFloat(document.getElementById('control_churn').value);

    // 2. Calculation of Average Treatment Effect on the Treated (ATT)
    // ATT = Outcome (Untreated) - Outcome (Treated)
    const treatmentEffect = controlChurn - treatedChurn;
    const percentEffect = (treatmentEffect * 100).toFixed(1);

    // 3. Output and Detailed Interpretation
    const resultDiv = document.getElementById('result_psm');

    let message = `<h2>PSM TREATMENT EFFECT REPORT</h2>`;
    message += `<p><strong>Churn Rate (Treated/Tutoring):</strong> ${(treatedChurn * 100).toFixed(1)}%</p>`;
    message += `<p><strong>Churn Rate (Matched Control/No Tutoring):</strong> ${(controlChurn * 100).toFixed(1)}%</p>`;
    
    message += `<p><strong>Estimated Average Treatment Effect on the Treated (ATT):</strong> <strong style="color: ${treatmentEffect > 0 ? 'green' : treatmentEffect < 0 ? 'red' : 'black'}; font-size: 1.2em;">${percentEffect}% Reduction in Churn</strong></p>`;

    message += `<h3>STRATEGIC VALIDATION CONCLUSION:</h3>`;
    
    if (treatmentEffect > 0.05) { // 5 percentage point improvement
        message += `<p><strong>STRONG CAUSAL IMPACT:</strong> The tutoring intervention is highly effective, reducing churn by over 5 percentage points among similar students. **Action:** Scale the tutoring program institution-wide immediately. The investment is validated.</p>`;
    } else if (treatmentEffect > 0) {
        message += `<p><strong>MODERATE IMPACT:</strong> The intervention is effective but has a small margin. **Action:** Continue the program but attempt to optimize the delivery (e.g., group vs. 1-on-1) to increase the effect size (ATT).</p>`;
    } else if (treatmentEffect < 0) {
        message += `<p><strong>NEGATIVE OR NO IMPACT:</strong> The churn rate in the treated group is higher than the control. **Action:** Suspend the intervention. The program is either poorly designed, or its perceived stigma is actively driving students away. Needs immediate re-evaluation.</p>`;
    } else {
        message += `<p><strong>NO SIGNIFICANT IMPACT:</strong> The intervention had no measurable effect on churn. **Action:** Reallocate the budget from this program to a strategy with a higher validated ATT.</p>`;
    }
    
    resultDiv.innerHTML = message;
}
</script>

</body>
</html>